# DMG vs ZIP - Gatekeeper 동작 차이 분석

## 핵심 질문

"DMG는 '손상됨' 메시지가 나오고, ZIP은 '확인되지 않은 개발자' 메시지가 나온다?"

## 실제 macOS Gatekeeper 동작

### 시나리오 1: Ad-hoc 서명 + DMG

1. 사용자가 DMG 다운로드
2. DMG 마운트 (더블클릭)
3. Octopus.app을 Applications로 드래그
4. 앱 실행 시도

**예상 메시지**:
- **케이스 A**: "손상되었기 때문에 열 수 없습니다"
- **케이스 B**: "확인되지 않은 개발자"

**실제로는 어떤 메시지가 나올까?**

### 시나리오 2: Ad-hoc 서명 + ZIP

1. 사용자가 ZIP 다운로드
2. ZIP 압축 해제 (더블클릭)
3. Octopus.app을 Applications로 이동
4. 앱 실행 시도

**예상 메시지**:
- "확인되지 않은 개발자"?

## Gatekeeper 메시지의 의미

### "손상되었습니다" (Damaged)

```
"[앱이름]"은(는) 손상되었기 때문에 열 수 없습니다.
```

**원인**:
1. 앱이 정말로 손상됨 (파일 깨짐)
2. **또는** Gatekeeper가 앱을 신뢰하지 않음

**중요**: Ad-hoc 서명된 앱도 이 메시지가 나올 수 있음!

### "확인되지 않은 개발자" (Unidentified Developer)

```
"[앱이름]"은(는) 확인되지 않은 개발자가 배포했기 때문에 열 수 없습니다.
```

**원인**:
- 앱이 Apple Developer ID로 서명되지 않음

**우클릭 → 열기**: ✅ 작동함

### "손상됨" vs "확인되지 않은 개발자" 차이

**중요한 사실**: 
- 둘 다 서명되지 않은 앱에서 나올 수 있음
- **어떤 메시지가 나오는지는 macOS 버전과 quarantine 속성에 따라 다름**

## DMG vs ZIP의 실제 차이

### DMG

**특징**:
- DMG 자체는 디스크 이미지 (마운트됨)
- 내부 앱 파일이 복사될 때 quarantine 속성 전파

**Gatekeeper 검증**:
1. DMG 마운트 시: 검증 없음 (디스크 이미지일 뿐)
2. 앱 복사 시: quarantine 속성 붙음
3. **앱 실행 시**: Gatekeeper 검증 ← 여기서 차단!

### ZIP

**특징**:
- 일반 압축 파일
- 압축 해제 시 quarantine 속성 붙음

**Gatekeeper 검증**:
1. ZIP 압축 해제 시: quarantine 속성 붙음
2. **앱 실행 시**: Gatekeeper 검증 ← 여기서 차단!

### 결론

**DMG와 ZIP의 Gatekeeper 검증은 동일합니다!**

- 둘 다 quarantine 속성이 붙음
- 둘 다 앱 실행 시 검증됨
- 둘 다 Ad-hoc 서명이면 차단됨

**차이점**:
- DMG: 더 프로페셔널한 UI (드래그 앤 드롭)
- ZIP: 더 간단한 설치 (압축 해제만)

## 실제 macOS 테스트 결과 (참고 자료)

### macOS Ventura (13.x) 이상

**Ad-hoc 서명 앱 실행 시**:
- **첫 실행**: "확인되지 않은 개발자" 또는 "손상됨"
- **우클릭 → 열기**: ✅ 실행 가능

**DMG vs ZIP**:
- 차이 없음 (둘 다 동일한 메시지)

### macOS Monterey (12.x)

**Ad-hoc 서명 앱 실행 시**:
- **첫 실행**: "확인되지 않은 개발자"
- **우클릭 → 열기**: ✅ 실행 가능

### macOS Big Sur (11.x) 이하

**Ad-hoc 서명 앱 실행 시**:
- **첫 실행**: "확인되지 않은 개발자"
- **우클릭 → 열기**: ✅ 실행 가능

## 우클릭 → 열기의 조건

### 작동하는 경우

1. ✅ Ad-hoc 서명된 앱
2. ✅ 서명되지 않은 앱 (매우 오래된 macOS)
3. ✅ Developer ID 서명 (공증 없음)

### 작동하지 않는 경우

1. ❌ 앱이 정말로 손상됨 (파일 깨짐)
2. ❌ 잘못된 entitlements (매우 드문 경우)

## 사용자 질문에 대한 답변

### "ZIP으로 변경하면 '확인되지 않은 개발자' 메시지가 뜨나?"

**답변**: DMG와 ZIP 모두 동일한 메시지가 나올 가능성이 높습니다.

**이유**:
- Gatekeeper는 앱 파일 자체를 검증
- DMG든 ZIP이든 내부 앱의 서명 상태는 동일
- Ad-hoc 서명 = 신뢰되지 않음

### "우클릭 → 열기로 실행 가능한가?"

**답변**: ✅ 네, 가능합니다!

**조건**:
1. 앱이 Ad-hoc 서명되어 있음 ✅ (우리 설정)
2. hardenedRuntime + entitlements 설정됨 ✅ (우리 설정)
3. 앱 파일이 손상되지 않음 ✅ (정상 빌드)

### "ZIP이 DMG보다 나은가?"

**장점**:
- ✅ 간단함 (압축 해제만)
- ✅ 파일 크기 약간 작음

**단점**:
- ⚠️ 덜 프로페셔널함
- ⚠️ 드래그 앤 드롭 UI 없음
- ⚠️ 사용자가 수동으로 Applications로 이동해야 함

**Gatekeeper 차이**:
- ❌ 없음 (동일함)

