# 배포 문서

## 배포 준비 단계

### 필수 검증
1. **전체 타입 검사**
   ```bash
   npx tsc --noEmit
   ```
   - 모든 TypeScript 파일의 타입 오류를 확인합니다.

2. **전체 린트 검사**
   ```bash
   npm run lint
   ```
   - ESLint를 통해 코드 품질과 스타일을 검증합니다.

3. **단위 테스트 실행**
   ```bash
   npm run test
   ```
   - Vitest를 사용하여 모든 단위 테스트를 통과해야 합니다.

### 추가 체크 사항
- **버전 확인**: package.json의 버전이 Git 태그와 일치하는지 확인 (예: v0.0.3)
- **CHANGELOG.md 업데이트**: 새 버전의 변경사항을 기록
- **Git 상태**: 모든 변경사항이 커밋되고, 워킹 디렉토리가 깨끗한지 확인
- **빌드 테스트**: 로컬에서 `npm run build`가 성공하는지 확인

## GitHub Actions 배포 워크플로우

### Release 워크플로우 특징
- **트리거**: `v*.*.*` 태그 푸시 또는 수동 실행
- **플랫폼**: macOS, Windows, Linux (Ubuntu)에서 병렬 빌드
- **코드 서명**: macOS용 CSC_LINK/CSC_KEY_PASSWORD 시크릿이 있을 경우 적용
- **아티팩트 업로드**: 각 플랫폼별 빌드 결과물을 artifacts로 저장

### 잠재적 에러 포인트 및 체크사항
1. **빌드 실패**
   - native modules 재빌드: `npm run prebuild`가 better-sqlite3 등 native 모듈을 올바르게 빌드하는지 확인
   - 환경 변수: GH_TOKEN이 제대로 설정되었는지

2. **릴리스 생성 실패**
   - CHANGELOG.md 형식: `## [버전]` 형식을 따르는지 확인
   - 아티팩트 경로: `release/` 디렉토리에 파일들이 생성되는지

3. **코드 서명 및 보안 (macOS)**
   - 본 프로젝트는 유료 애플 개발자 계정이 없으므로 **Ad-hoc(임시) 서명** 방식으로 배포됩니다.
   - **주의**: Apple Silicon (M1/M2/M3) 맥에서는 서명이 없는 앱은 무조건 "손상됨"으로 표시됩니다.
   - **"손상됨" 에러 해결법**: 인터넷에서 다운로드한 파일에는 보안 플래그(Quarantine)가 붙습니다. 이를 터미널에서 제거해야 합니다.
     ```bash
     xattr -d com.apple.quarantine /Applications/Octopus.app
     ```
   - **설정**: `package.json`에서 `identity: "-"`를 설정하여 최소한의 ad-hoc 서명을 강제합니다.

4. **E2E 테스트 생략**
   - 현재 워크플로우에서 E2E 테스트가 주석 처리되어 있음 (높은 실패율로 인해)
   - 배포 전 로컬에서 `npx playwright test` 실행 권장

## 자동 업데이트 시스템

### 구현 방식
- **라이브러리**: electron-updater 사용
- **배포 채널**: GitHub Releases
- **업데이트 확인**: 앱 시작 3초 후 자동 체크
- **다운로드**: Windows/Linux는 자동, macOS는 수동 다운로드 (autoDownload: false)

### 이벤트 처리
- `update-available`: 새 버전 발견 시 사용자에게 알림
- `update-downloaded`: 다운로드 완료 후 재시작 요청
- `error`: 업데이트 오류 로깅 및 사용자 알림

### IPC 핸들러
- `check-for-updates`: 수동 업데이트 체크
- `install-update`: 업데이트 설치 및 재시작
- `open-download-page`: GitHub Releases 페이지 열기 (macOS용)

### 주의사항
- 개발 환경에서는 업데이트 체크가 비활성화될 수 있음
- 프로덕션 빌드에서만 정상 작동
- GitHub Releases에 올바른 버전 태그와 아티팩트가 있어야 함

## 배포 절차

1. 버전 업데이트: `npm run version:patch/minor/major` 사용
2. CHANGELOG.md 업데이트
3. 모든 검증 통과 확인
4. Git 태그 생성: `git tag v0.0.4`
5. GitHub에 푸시: `git push origin main --tags`
6. 워크플로우 완료 대기
7. GitHub Releases 확인 및 필요시 수정</content>
<parameter name="filePath">배포.md